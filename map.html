<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Tampico â€“ Map</title>

<!-- Leaflet -->
<link rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-sA+e2E1Hn0z4XLaOcxEVmHm6C4e1Dac6JcJGiJTAn7Y="
  crossorigin="anonymous">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-o9N1jvHDVfG/ayWrlOZ8LbyKF90UXebLk9Z9H7uPsk0="
  crossorigin="anonymous"></script>

<style>
html,body,#map{height:100%;margin:0}
.popup h3{margin:.2em 0;font-size:1rem}
.popup table{font-size:.85rem;border-collapse:collapse}
.popup td{padding:2px 6px;border-bottom:1px solid #eee}
.popup a{color:#0654ad}
</style>
</head>
<body>
<div id="map"></div>

<script type="module">
/* ðŸ”— cole aqui O MESMO URL usado no form ------------------- */
const API="https://script.google.com/macros/s/AKfycbz6bPCi7VQ-BV2ADeyX30lt9cHjodtBbWWm1ILPaEf6flhiNsdT0uRw_vNd-mcyW2pG/exec";

/* ---------- inicia mapa Brasil --------------------------- */
const map=L.map('map').setView([-14.235,-51.925],4);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:19,attribution:'Â© OpenStreetMap'
}).addTo(map);

/* ---------- carrega linhas da planilha ------------------- */
try{
  const res=await fetch(API);            // GET sem parÃ¢metros
  if(!res.ok) throw new Error(res.statusText);
  const json=await res.json();

  json.forEach(p=>{
    if(!p.lat||!p.lng) return;           // ignora linhas sem geo
    const marker=L.marker([+p.lat,+p.lng]).addTo(map);

    const row=(lbl,val)=>`
      <tr><td><strong>${lbl}</strong></td><td>${val.join(" | ")}</td></tr>`;

    const html=`
      <div class="popup">
        <h3>${p.store}</h3>
        <small>${p.timestamp} â€“ ${p.city}</small>
        <table>
          ${row("Tampico",p.tampico)}
          ${row("Del Valle",p.delValle)}
          ${row(p.otherBrand||"Other",p.otherPrices)}
        </table>
        ${p.photos.filter(u=>u).map(
            (u,i)=>`<a href="${u}" target="_blank">Photo ${i+1}</a>`
          ).join(" Â· ")}
      </div>`;
    marker.bindPopup(html);
  });

}catch(err){
  alert("Erro ao carregar dados:\n"+err.message);
  console.error(err);
}
</script>
</body>
</html>
