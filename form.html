<script>
/* --------- CONFIGURE AQUI -------------------------------- */
const API = "https://script.google.com/macros/s/AKfycbzd1mNJljpYl5Ztr_jQA0uaJcQJ3RZb7PDIqD2I5JBUP0b83wc6oau3K-NDdNrcrFLt/exec";
/* --------------------------------------------------------- */

/* Geolocalização – preenche lat/lng ocultos */
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(pos => {
    document.getElementById("lat").value = pos.coords.latitude;
    document.getElementById("lng").value = pos.coords.longitude;
  }, err => console.warn("Geolocation error:", err.message));
}

/* Envio do formulário */
document.getElementById("posForm").addEventListener("submit", async ev => {
  ev.preventDefault();
  const msg   = document.getElementById("msg");
  msg.textContent = "Saving…"; msg.style.color = "black";

  /* -------- monta payload JSON -------- */
  const payload = {
    storeName      : document.getElementById("store").value.trim(),
    city           : document.getElementById("city").value.trim(),
    latitude       : parseFloat(document.getElementById("lat").value) || "",
    longitude      : parseFloat(document.getElementById("lng").value) || "",
    tampico        : [...document.querySelectorAll(".tampico") ].map(i => i.value.trim()),
    delValle       : [...document.querySelectorAll(".delvalle")].map(i => i.value.trim()),
    otherBrandName : document.getElementById("otherBrand").value.trim(),
    otherPrices    : [...document.querySelectorAll(".other")   ].map(i => i.value.trim()),
    photos         : []  // implementar depois, se quiser fotos
  };

  /* -------- envia como x-www-form-urlencoded ------------- */
  const body = "data=" + encodeURIComponent(JSON.stringify(payload));

  try {
    const res  = await fetch(API, {
      method  : "POST",
      headers : {"Content-Type":"application/x-www-form-urlencoded"},
      body
    });
    const json = await res.json();

    if (json.status === "OK") {
      msg.textContent = "Data saved ✓"; msg.style.color = "green";
      ev.target.reset();
    } else {
      throw new Error(json.error || "Unknown error");
    }
  } catch (err) {
    msg.textContent = "Error: " + err.message; msg.style.color = "red";
    console.error(err);
  }
});
</script>
