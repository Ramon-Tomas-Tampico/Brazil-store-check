<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDV Form – Store Check</title>
  <style>
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f5f5f5}
    .wrapper{max-width:600px;margin:0 auto;padding:20px}
    h1{text-align:center;color:#333}
    fieldset{border:1px solid #ccc;margin-bottom:20px;padding:16px;border-radius:8px}
    legend{font-weight:bold}
    label{display:block;margin-top:12px;font-size:14px}
    input[type=text],input[type=number]{width:100%;padding:8px;font-size:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    button{display:block;width:100%;padding:14px;font-size:16px;font-weight:bold;
      background:#28d463;color:#fff;border:none;border-radius:8px;cursor:pointer;margin-top:20px}
    button:hover{background:#24b859}
    .msg{margin-top:12px;font-weight:bold;text-align:center}
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Point-of-Sale Form</h1>

    <form id="posForm">
      <!-- PDV info -->
      <fieldset>
        <legend>Store information</legend>
        <label>Store name
          <input type="text" id="store" required>
        </label>
        <label>City
          <input type="text" id="city" required>
        </label>
      </fieldset>

      <!-- Prices – Tampico -->
      <fieldset>
        <legend>Tampico Prices</legend>
        <div class="grid">
          <label>2 L <input class="tampico" type="number" step="0.01"></label>
          <label>1.5 L <input class="tampico" type="number" step="0.01"></label>
          <label>1 L <input class="tampico" type="number" step="0.01"></label>
          <label>450 ml <input class="tampico" type="number" step="0.01"></label>
          <label>250 ml <input class="tampico" type="number" step="0.01"></label>
          <label>200 ml <input class="tampico" type="number" step="0.01"></label>
          <label>Tetra 1 L <input class="tampico" type="number" step="0.01"></label>
          <label>Can <input class="tampico" type="number" step="0.01"></label>
        </div>
      </fieldset>

      <!-- Prices – Del Valle -->
      <fieldset>
        <legend>Del Valle Prices</legend>
        <div class="grid">
          <label>2 L <input class="delvalle" type="number" step="0.01"></label>
          <label>1.5 L <input class="delvalle" type="number" step="0.01"></label>
          <label>1 L <input class="delvalle" type="number" step="0.01"></label>
          <label>450 ml <input class="delvalle" type="number" step="0.01"></label>
          <label>250 ml <input class="delvalle" type="number" step="0.01"></label>
          <label>200 ml <input class="delvalle" type="number" step="0.01"></label>
          <label>Tetra 1 L <input class="delvalle" type="number" step="0.01"></label>
          <label>Can <input class="delvalle" type="number" step="0.01"></label>
        </div>
      </fieldset>

      <!-- Prices – Other Brand -->
      <fieldset>
        <legend>Other Brand Prices</legend>
        <label>Brand name
          <input type="text" id="otherBrand">
        </label>
        <div class="grid">
          <label>2 L <input class="other" type="number" step="0.01"></label>
          <label>1.5 L <input class="other" type="number" step="0.01"></label>
          <label>1 L <input class="other" type="number" step="0.01"></label>
          <label>450 ml <input class="other" type="number" step="0.01"></label>
          <label>250 ml <input class="other" type="number" step="0.01"></label>
          <label>200 ml <input class="other" type="number" step="0.01"></label>
          <label>Tetra 1 L <input class="other" type="number" step="0.01"></label>
          <label>Can <input class="other" type="number" step="0.01"></label>
        </div>
      </fieldset>

      <!-- Hidden lat/lng -->
      <input type="hidden" id="lat">
      <input type="hidden" id="lng">

      <button type="submit">Save Point-Of-Sale</button>
      <div class="msg" id="msg"></div>
    </form>
  </div>

  <script>
    /* ============ CONFIG ============ */
    const API = "https://script.google.com/macros/s/AKfycbzd1mNJljpYl5Ztr_jQA0uaJcQJ3RZb7PDIqD2I5JBUP0b83wc6oau3K-NDdNrcrFLt/exec";

    /* ============ GEOLOCATION ============ */
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        document.getElementById("lat").value = pos.coords.latitude;
        document.getElementById("lng").value = pos.coords.longitude;
      }, err => console.warn("Geolocation error:", err.message));
    } else {
      console.warn("Geolocation not supported");
    }

    /* ============ FORM SUBMIT ============ */
    document.getElementById("posForm").addEventListener("submit", async evt => {
      evt.preventDefault();
      const msg = document.getElementById("msg");
      msg.textContent = "Saving…";

      const payload = {
        storeName      : document.getElementById("store").value.trim(),
        city           : document.getElementById("city").value.trim(),
        latitude       : parseFloat(document.getElementById("lat").value) || "",
        longitude      : parseFloat(document.getElementById("lng").value) || "",
        tampico        : [...document.querySelectorAll(".tampico") ].map(i=>i.value.trim()),
        delValle       : [...document.querySelectorAll(".delvalle")].map(i=>i.value.trim()),
        otherBrandName : document.getElementById("otherBrand").value.trim(),
        otherPrices    : [...document.querySelectorAll(".other")   ].map(i=>i.value.trim()),
        photos         : [] // você pode preencher depois
      };

      try{
        const res = await fetch(API, {
          method : "POST",
          headers: {"Content-Type":"application/json"},
          body   : JSON.stringify(payload)
        });

        if (!res.ok) throw new Error(res.status + " " + res.statusText);
        const data = await res.json(); // espera {"status":"OK"} ou {"error":...}

        if (data.status === "OK") {
          msg.style.color = "green";
          msg.textContent = "Data saved ✓";
          evt.target.reset();
        } else {
          throw new Error(data.error || "Unknown error");
        }

      }catch(err){
        msg.style.color = "red";
        msg.textContent = "Error: " + err.message;
        console.error(err);
      }
    });
  </script>
</body>
</html>
